<!DOCTYPE html>
<html>
<head>
    <title>Eurovision 2017 Quiz</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="socket.io.js"></script>
    <link rel="stylesheet" href="./css/countrySelect.css">
    
    <script src="./js/countrySelect.min.js"></script>

    
</head>
<body>
    <div id></div>
    <div id="questionContainer">
        <h1 id=questionPlace>Enter your name!</h1>
    </div>
    <div id="answersContainer">
        <input type="text" id="username"></input>
        <input type="text" id="country"></input>
        <button id=buttonRegister>Register</button>
    </div>




    <script>
    var socket = io("localhost:8080");
    function loadQuestion(newQuestion){
        console.log(newQuestion);
        //var question = JSON.parse(newQuestion);
        var question = newQuestion;
        var answers = '<ol class="divAnswers">\
        <li><button class="answer1" id="answer0">'+ question.answers[0] +'</button></li>\
        <li><button class="answer2" id="answer1">'+ question.answers[1] +'</button></li>\
        <li><button class="answer3" id="answer2">'+ question.answers[2] +'</button></li>\
        <li><button class="answer4" id="answer3">'+ question.answers[3] +'</button></li>\
        </ol>'
        
        for(var i = 0; i < 4; i++){
            $('#answer' + i).click(function(){
                sendAnswer(newQuestion, $('#answer' + i).val());
            })
        }

        $('#answersContainer').append(answers);
        $('#questionContainer').append('<h1>'+ question.question +'</h1>');
    }
        
 function sendAnswer(newQuestion,answer){
        
       socket.emit('answer',{
            "country" : newQuestion.country,
            "questionId" : newQuestion.questionId,
            "answer" : answer,
            "userId" : localStorage.userId            
        })
        
        waitingScreen();
    }

        
    function clearPage(){
        $('#questionContainer').empty();
        $('#answersContainer').empty();
    }
        
    function register(){
        localStorage.username = $("#username").val();
        localStorage.id = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
        return v.toString(16);
        });
        localStorage.country = $('#country');
        var registerObject = [];
/*
       socket.emit('register',{
                   "id" : localStorage.id,
                   "username" : localStorage.username,
                   "contry" : localStorage.country,
                   "answers" : []
                    });
*/
        waitingScreen();
    }
    
    function waitingScreen(){
        clearPage();
        $('#questionContainer').append('<h1> Waiting for others </h1>');
        $('#answersContainer').append('<img src="https://media0.giphy.com/media/3oEjI6SIIHBdRxXI40/giphy.gif"></img>')
    }
        

        
    

     socket.on('newQuestion',loadQuestion);
        
    if(localStorage.username == null){
        $("#country").countrySelect();
    }
        
    $("#buttonRegister").click(function(){
        register();
    });
    </script>
</body>
</html>